<!--
BSD 2-Clause License

Copyright (c) 2017, The HeadphoneCheck Authors (see AUTHORS)
All rights reserved.

Contact Ray Gonzalez raygon@mit.edu or Kevin J. P. Woods kwoods@mit.edu
=======================================================================
-->
<!DOCTYPE html>
<html>
  <head>
    <!-- Import jQuery from Google CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="/templates/HeadphoneCheck.js"></script> 
    <style type="text/css">
      body {
        margin: auto;
        margin-top: 15vh;
        font-size: 20px;
        width: 60%;
        padding:50px;
        border: 5px black solid;
      }

      button {
        margin-top: 10px;
        margin-bottom: 10px;
        font-size: 20px;
        font-family: serif;
        cursor: pointer;
      }

      #message {
        margin-top: -150px;
        padding: 15px;
        float: right;
      }

      #modal {
	      position: fixed;
	      left: 0;
	      top: 0;
	      width: 100%;
	      height: 100%;
	      background-color: rgba(0,0,0,0.4);
      }

      .instructions {
        font-family: Monaco;
        font-size: 16px;
	      margin: auto;
	      padding: 40px;
	      width: 80%;
	      height: 100vh;
	      background-color: white;
      }

      #sign {
	      font-size: 25px;
	      font-weight: bold;
	      color: rgba(0,0,0,0.4);
      }

      .move {
        display: inline;
        margin-right: 10px;
        padding-left: 20px;
        padding-right: 20px;
        padding-bottom: 5px;
        font-size: 25px;
        cursor: pointer;
      }

      #instruction-move {
	      position: absolute;
	      right: 13%;
	      bottom: 15px;
      }

      #sign:hover,
      #sign:focus {
	      cursor: pointer;
	      color: rgba(0,0,0,0.7);
      }
    </style>
  </head>
  <!-- Run the headphone check when the page finishes loading -->
  <body onload="HeadphoneCheck.runHeadphoneCheck();">
    <button id="message">Instructions</button>
		<div id="modal">
			<div class="instructions">
				<span id="sign" style="float: right;">&times;</span>
				<div id="instruction1">
					<img src="/templates/question/img/1.png" style="width:80%; height: auto;">
					<p>&ordm; Fraction numbers inside the bracket means: [current audio number / total number of audios] </p>
					<p>&ordm; Click 'Play Audio' to play the current audio </p>
					<p>&ordm; You may rotate the 3D head, but you can not perform anything towards the head directly </p>
				</div>
				<div id="instruction2" style="display: none;">
					<img src="/templates/question/img/2.png" style="width:80%; height: auto;">
					<p>&ordm; Click 'Pause Audio' to pause the current audio </p>
				</div>
				<div id="instruction3" style="display: none;">
					<img src="/templates/question/img/3.png" style="width:80%; height: auto;">
					<p>&ordm; You may re-play the audio as many times as needed </p>
					<p>&ordm; Once you have finished listening to the audio, you may see a dropdown menu in which you may select the number of sources you have heard </p>
				</div>
				<div id="instruction4" style="display: none;">
					<img src="/templates/question/img/4.png" style="width:80%; height: auto;">
					<p>&ordm; Once you have selected a numberï¼Œthree 2D views will automatically appeared </p>
					<p>&ordm; These three views are where you perform the annotation </p>
					<p>&ordm; Press 'option' or 'Alt' key to add an annotation once you see the cursor turning to '+' </p>
					<p>&ordm; Press 'command' key to delete an annotation once you see the cursor turning to '-' </p>
					<p>&ordm; Keep in mind that deleting an annotation means to delete both its annotated azimuth and elevation(s) </p>
				</div>
				<div id="instruction5" style="display: none;">
					<img src="/templates/question/img/5.png" style="width:80%; height: auto;">
					<p>&ordm; You may adjust the azimuth and the elevation(s) with [+] and [-] buttons, or by dragging the annotation dots </p>
					<p>&ordm; At certain angles, the annotation can be seen from both the back and the side view; the system will annotate the 'second elevation' for you</p>
					<p>&ordm; The annotation will appear automatically in the 3D view </p>
					<p>&ordm; Keep in mind that the head view is for azimuth annotation, and the back and side views are for elevation annotation </p>
				</div>
				<div id="instruction6" style="display: none;">
					<img src="/templates/question/img/6.png" style="width:80%; height: auto;">
					<p>&ordm; You can not annotate more annotations than the number of sources you have entered;</p>
					<p>&ordm; You may change the number of sources you have entered</p>
					<p>&ordm; You may annotate less number of annotation(s) if you want</p>
					<p>&ordm; Keep in mind that you must annotate at least 1 annotation (at least 1 azimuth and 1 anotation) </p>
				</div>
				<div id="instruction-move">
					<button class="move" id="instruction-left">&lt;</button>
					<button class="move" id="instruction-right">&gt;</button>
				</div>
			</div>
		</div>
    <div id="hc-container"></div>
    <script>
      $(document).on('hcHeadphoneCheckEnd', function(event, data) {
        var results = data.data;
        var config = data.config;
        var didPass = data.didPass;
        if (didPass) {
          ajax_start();
          window.location.href = '/templates/question/question.html';
        }
        else {
          $('<div/>', {
            html: 'Screening task failed.<br/><br/>Total Correct: ' + results.totalCorrect + '<br/>Please re-do the head phone check tasks'
          }).appendTo($('body'));
        }
      });

      var curr_instruction = 1;
  
      document.getElementById('message').addEventListener("click",popRules);
      document.getElementById('instruction-left').addEventListener("click",move_instruction_last);
      document.getElementById('instruction-right').addEventListener("click",move_instruction_next);
      document.getElementById("sign").addEventListener("click",closeRules);
  
      function popRules(e){ 
        e.preventDefault();
        modal.style.display = "block";
      }
  
      function closeRules(e){ 
        e.preventDefault();
        modal.style.display = "none";
      }
  
      function move_instruction_next(e){
        e.preventDefault();
        if (curr_instruction < 6) {
          document.getElementById('instruction'+curr_instruction).style.display = 'none';
          document.getElementById('instruction'+(curr_instruction+1)).style.display = '';
          curr_instruction += 1;
        }
      }
  
      function move_instruction_last(e){
        e.preventDefault();
        if (curr_instruction > 1) {
          document.getElementById('instruction'+curr_instruction).style.display = 'none';
          document.getElementById('instruction'+(curr_instruction-1)).style.display = '';
          curr_instruction -= 1;
        }
      }

      function ajax_start(start){
        var req = new XMLHttpRequest(); 
        req.open('POST', '/start', true);
        req.send();
      }

    </script>
  </body>
</html>
